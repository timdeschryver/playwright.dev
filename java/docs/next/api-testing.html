<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/java/blog/rss.xml" title="Playwright Java RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/java/blog/atom.xml" title="Playwright Java Atom Feed">
<script src="/java/js/redirection.js"></script><title data-react-helmet="true">API testing | Playwright Java</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://playwright.dev/java/docs/next/api-testing"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="API testing | Playwright Java"><meta data-react-helmet="true" name="description" content="Playwright can be used to get access to the REST API of your application."><meta data-react-helmet="true" property="og:description" content="Playwright can be used to get access to the REST API of your application."><link data-react-helmet="true" rel="shortcut icon" href="/java/img/playwright-logo.svg"><link data-react-helmet="true" rel="canonical" href="https://playwright.dev/java/docs/next/api-testing"><link data-react-helmet="true" rel="alternate" href="https://playwright.dev/java/docs/next/api-testing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://playwright.dev/java/docs/next/api-testing" hreflang="x-default"><link rel="stylesheet" href="/java/assets/css/styles.18cfce4d.css">
<link rel="preload" href="/java/assets/js/runtime~main.ce20a0bc.js" as="script">
<link rel="preload" href="/java/assets/js/main.1b15c50b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/java/"><div class="navbar__logo"><img src="/java/img/playwright-logo.svg" alt="Playwright logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/java/img/playwright-logo.svg" alt="Playwright logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Playwright for Java</b></a><a class="navbar__item navbar__link navbar__link--active" href="/java/docs/next/intro">Docs</a><a class="navbar__item navbar__link" href="/java/docs/next/api/class-playwright">API</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/java/docs/next/intro">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/java/docs/next/api-testing">Next</a></li><li><a class="dropdown__link" href="/java/docs/intro">1.17</a></li><li><a class="dropdown__link" href="/java/docs/1.16/intro">1.16</a></li><li><a class="dropdown__link" href="/java/docs/1.15/intro">1.15</a></li><li><a class="dropdown__link" href="/java/docs/1.14/why-playwright">1.14</a></li><li><a class="dropdown__link" href="/java/versions">All versions</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">Java</a><ul class="dropdown__menu"><li><a href="/java/docs/next/api-testing" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">Java</a></li><li><a href="/docs/next/api-testing" target="_self" rel="noopener noreferrer" class="dropdown__link">Node.js</a></li><li><a href="/python/docs/next/api-testing" target="_self" rel="noopener noreferrer" class="dropdown__link">Python</a></li><li><a href="/dotnet/docs/next/api-testing" target="_self" rel="noopener noreferrer" class="dropdown__link">.NET</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/playwright" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_71bT toggle_3Zt9 toggleChecked_2FvV toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" checked="" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_2P1H"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_3atr searchBarLoadingRing_1FtX"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/intro">Getting started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/inspector">Inspector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/trace-viewer">Trace Viewer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/codegen">Test Generator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/debug">Debugging tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/release-notes">Release notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/test-runners">Test Runners</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/actionability">Auto-waiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/java/docs/next/api-testing">API testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/assertions">Assertions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/auth">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/browsers">Browsers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/browser-contexts">Browser Contexts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/cli">Command line tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/dialogs">Dialogs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/downloads">Downloads</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/emulation">Emulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/evaluating">Evaluating JavaScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/events">Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/extensibility">Extensibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/frames">Frames</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/handles">Handles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/input">Input</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/locators">Locators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/multithreading">Multithreading</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/navigations">Navigations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/network">Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/pages">Pages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/pom">Page Object Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/screenshots">Screenshots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/selectors">Selectors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/verification">Verification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/java/docs/next/videos">Videos</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Integrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/java/docs/next/languages">Supported languages</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Playwright Java<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/java/docs/intro">latest version</a></b> (<!-- -->1.17<!-- -->).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->Next</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>API testing</h1></header><p>Playwright can be used to get access to the <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener noreferrer">REST</a> API of your application.</p><p>Sometimes you may want to send requests to the server directly from Node.js without loading a page and running js code in it. A few examples where it may come in handy:</p><ul><li>Test your server API.</li><li>Prepare server side state before visiting the web application in a test.</li><li>Validate server side post-conditions after running some actions in the browser.</li></ul><p>All of that could be achieved via <a title="APIRequestContext" href="/java/docs/next/api/class-apirequestcontext">APIRequestContext</a> methods.</p><ul><li><a href="#writing-api-test">Writing API Test</a></li><li><a href="#prepare-server-state-via-api-calls">Prepare server state via API calls</a></li><li><a href="#check-the-server-state-after-running-user-actions">Check the server state after running user actions</a></li><li><a href="#reuse-authentication-state">Reuse authentication state</a></li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="writing-api-test">Writing API Test<a aria-hidden="true" class="hash-link" href="#writing-api-test" title="Direct link to heading">â€‹</a></h2><p><a title="APIRequestContext" href="/java/docs/next/api/class-apirequestcontext">APIRequestContext</a> can send all kinds of HTTP(S) requests over network.</p><p>The following example demonstrates how to use Playwright to test issues creation via <a href="https://docs.github.com/en/rest" target="_blank" rel="noopener noreferrer">GitHub API</a>. The test suite will do the following:</p><ul><li>Create a new repository before running tests.</li><li>Create a few issues and validate server state.</li><li>Delete the repository after running tests.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="configure">Configure<a aria-hidden="true" class="hash-link" href="#configure" title="Direct link to heading">â€‹</a></h3><p>GitHub API requires authorization, so we&#x27;ll configure the token once for all tests. While at it, we&#x27;ll also set the <code>baseURL</code> to simplify the tests.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package org.example;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIRequest;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIRequestContext;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.Playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.AfterAll;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.BeforeAll;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.TestInstance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class TestGitHubAPI {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final String API_TOKEN = System.getenv(&quot;GITHUB_API_TOKEN&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private Playwright playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private APIRequestContext request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void createPlaywright() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    playwright = Playwright.create();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void createAPIRequestContext() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // We set this header per GitHub guidelines.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    headers.put(&quot;Accept&quot;, &quot;application/vnd.github.v3+json&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Add authorization token to all requests.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Assuming personal access token available in the environment.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    headers.put(&quot;Authorization&quot;, &quot;token &quot; + API_TOKEN);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    request = playwright.request().newContext(new APIRequest.NewContextOptions()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      // All requests we send go to this API endpoint.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .setBaseURL(&quot;https://api.github.com&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .setExtraHTTPHeaders(headers));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @BeforeAll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void beforeAll() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createPlaywright();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createAPIRequestContext();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void disposeAPIRequestContext() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (request != null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      request.dispose();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      request = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void closePlaywright() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (playwright != null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      playwright.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      playwright = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @AfterAll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void afterAll() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    disposeAPIRequestContext();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    closePlaywright();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="write-tests">Write tests<a aria-hidden="true" class="hash-link" href="#write-tests" title="Direct link to heading">â€‹</a></h3><p>Now that we initialized request object we can add a few tests that will create new issues in the repository.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package org.example;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.Gson;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.JsonArray;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.JsonElement;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.JsonObject;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIRequest;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIRequestContext;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIResponse;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.Playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.options.RequestOptions;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.AfterAll;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.BeforeAll;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.Test;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.TestInstance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.Collections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import static org.junit.jupiter.api.Assertions.*;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class TestGitHubAPI {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final String REPO = &quot;test-repo-2&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final String USER = System.getenv(&quot;GITHUB_USER&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final String API_TOKEN = System.getenv(&quot;GITHUB_API_TOKEN&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private Playwright playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private APIRequestContext request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void shouldCreateBugReport() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Map&lt;String, String&gt; data = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;title&quot;, &quot;[Bug] report 1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;body&quot;, &quot;Bug description&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse newIssue = request.post(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      RequestOptions.create().setData(data));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(newIssue.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse issues = request.get(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(issues.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonArray json = new Gson().fromJson(issues.text(), JsonArray.class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonObject issue = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    for (JsonElement item : json) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      JsonObject itemObj = item.getAsJsonObject();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (!itemObj.has(&quot;title&quot;)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        continue;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (&quot;[Bug] report 1&quot;.equals(itemObj.get(&quot;title&quot;).getAsString())) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        issue = itemObj;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertNotNull(issue);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(&quot;Bug description&quot;, issue.get(&quot;body&quot;).getAsString(), issue.toString());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void shouldCreateFeatureRequest() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Map&lt;String, String&gt; data = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;title&quot;, &quot;[Feature] request 1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;body&quot;, &quot;Feature description&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse newIssue = request.post(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      RequestOptions.create().setData(data));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(newIssue.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse issues = request.get(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(issues.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonArray json = new Gson().fromJson(issues.text(), JsonArray.class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonObject issue = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    for (JsonElement item : json) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      JsonObject itemObj = item.getAsJsonObject();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (!itemObj.has(&quot;title&quot;)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        continue;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (&quot;[Feature] request 1&quot;.equals(itemObj.get(&quot;title&quot;).getAsString())) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        issue = itemObj;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertNotNull(issue);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(&quot;Feature description&quot;, issue.get(&quot;body&quot;).getAsString(), issue.toString());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="setup-and-teardown">Setup and teardown<a aria-hidden="true" class="hash-link" href="#setup-and-teardown" title="Direct link to heading">â€‹</a></h3><p>These tests assume that repository exists. You probably want to create a new one before running tests and delete it afterwards. Use <code>@BeforeAll</code> and <code>@AfterAll</code> hooks for that.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void createTestRepository() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse newRepo = request.post(&quot;/user/repos&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      RequestOptions.create().setData(Collections.singletonMap(&quot;name&quot;, REPO)));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(newRepo.ok(), newRepo.text());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @BeforeAll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void beforeAll() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createPlaywright();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createAPIRequestContext();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createTestRepository();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void deleteTestRepository() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (request != null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      APIResponse deletedRepo = request.delete(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      assertTrue(deletedRepo.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @AfterAll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void afterAll() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deleteTestRepository();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    disposeAPIRequestContext();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    closePlaywright();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="complete-test-example">Complete test example<a aria-hidden="true" class="hash-link" href="#complete-test-example" title="Direct link to heading">â€‹</a></h3><p>Here is the complete example of an API test:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package org.example;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.Gson;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.JsonArray;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.JsonElement;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.google.gson.JsonObject;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIRequest;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIRequestContext;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.APIResponse;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.Playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import com.microsoft.playwright.options.RequestOptions;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.junit.jupiter.api.*;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.Collections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import static org.junit.jupiter.api.Assertions.*;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class TestGitHubAPI {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final String REPO = &quot;test-repo-2&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final String USER = System.getenv(&quot;GITHUB_USER&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private static final String API_TOKEN = System.getenv(&quot;GITHUB_API_TOKEN&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private Playwright playwright;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  private APIRequestContext request;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void createPlaywright() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    playwright = Playwright.create();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void createAPIRequestContext() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // We set this header per GitHub guidelines.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    headers.put(&quot;Accept&quot;, &quot;application/vnd.github.v3+json&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Add authorization token to all requests.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Assuming personal access token available in the environment.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    headers.put(&quot;Authorization&quot;, &quot;token &quot; + API_TOKEN);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    request = playwright.request().newContext(new APIRequest.NewContextOptions()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      // All requests we send go to this API endpoint.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .setBaseURL(&quot;https://api.github.com&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      .setExtraHTTPHeaders(headers));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void createTestRepository() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse newRepo = request.post(&quot;/user/repos&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      RequestOptions.create().setData(Collections.singletonMap(&quot;name&quot;, REPO)));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(newRepo.ok(), newRepo.text());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @BeforeAll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void beforeAll() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createPlaywright();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createAPIRequestContext();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    createTestRepository();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void deleteTestRepository() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (request != null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      APIResponse deletedRepo = request.delete(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      assertTrue(deletedRepo.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void disposeAPIRequestContext() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (request != null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      request.dispose();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      request = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void closePlaywright() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (playwright != null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      playwright.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      playwright = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @AfterAll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void afterAll() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    deleteTestRepository();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    disposeAPIRequestContext();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    closePlaywright();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void shouldCreateBugReport() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Map&lt;String, String&gt; data = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;title&quot;, &quot;[Bug] report 1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;body&quot;, &quot;Bug description&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse newIssue = request.post(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      RequestOptions.create().setData(data));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(newIssue.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse issues = request.get(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(issues.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonArray json = new Gson().fromJson(issues.text(), JsonArray.class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonObject issue = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    for (JsonElement item : json) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      JsonObject itemObj = item.getAsJsonObject();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (!itemObj.has(&quot;title&quot;)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        continue;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (&quot;[Bug] report 1&quot;.equals(itemObj.get(&quot;title&quot;).getAsString())) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        issue = itemObj;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertNotNull(issue);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(&quot;Bug description&quot;, issue.get(&quot;body&quot;).getAsString(), issue.toString());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  @Test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  void shouldCreateFeatureRequest() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Map&lt;String, String&gt; data = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;title&quot;, &quot;[Feature] request 1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data.put(&quot;body&quot;, &quot;Feature description&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse newIssue = request.post(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      RequestOptions.create().setData(data));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(newIssue.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    APIResponse issues = request.get(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(issues.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonArray json = new Gson().fromJson(issues.text(), JsonArray.class);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JsonObject issue = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    for (JsonElement item : json) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      JsonObject itemObj = item.getAsJsonObject();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (!itemObj.has(&quot;title&quot;)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        continue;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (&quot;[Feature] request 1&quot;.equals(itemObj.get(&quot;title&quot;).getAsString())) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        issue = itemObj;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertNotNull(issue);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(&quot;Feature description&quot;, issue.get(&quot;body&quot;).getAsString(), issue.toString());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="prepare-server-state-via-api-calls">Prepare server state via API calls<a aria-hidden="true" class="hash-link" href="#prepare-server-state-via-api-calls" title="Direct link to heading">â€‹</a></h2><p>The following test creates a new issue via API and then navigates to the list of all issues in the project to check that it appears at the top of the list. The check is performed using <a title="LocatorAssertions" href="/java/docs/next/api/class-locatorassertions">LocatorAssertions</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">@Test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">void lastCreatedIssueShouldBeFirstInTheList() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Map&lt;String, String&gt; data = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  data.put(&quot;title&quot;, &quot;[Feature] request 1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  data.put(&quot;body&quot;, &quot;Feature description&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  APIResponse newIssue = request.post(&quot;/repos/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    RequestOptions.create().setData(data));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  assertTrue(newIssue.ok());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  page.navigate(&quot;https://github.com/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Locator firstIssue = page.locator(&quot;a[data-hovercard-type=&#x27;issue&#x27;]&quot;).first();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  assertThat(firstIssue).hasText(&quot;[Feature] request 1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="check-the-server-state-after-running-user-actions">Check the server state after running user actions<a aria-hidden="true" class="hash-link" href="#check-the-server-state-after-running-user-actions" title="Direct link to heading">â€‹</a></h2><p>The following test creates a new issue via user interface in the browser and then checks via API if it was created:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">@Test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">void lastCreatedIssueShouldBeOnTheServer() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  page.navigate(&quot;https://github.com/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  page.click(&quot;text=New Issue&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  page.fill(&quot;[aria-label=&#x27;Title&#x27;]&quot;, &quot;Bug report 1&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  page.fill(&quot;[aria-label=&#x27;Comment body&#x27;]&quot;, &quot;Bug description&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  page.click(&quot;text=Submit new issue&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  String issueId = page.url().substring(page.url().lastIndexOf(&#x27;/&#x27;));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  APIResponse newIssue = request.get(&quot;https://github.com/&quot; + USER + &quot;/&quot; + REPO + &quot;/issues/&quot; + issueId);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  assertThat(newIssue).isOK();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  assertTrue(newIssue.text().contains(&quot;Bug report 1&quot;));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="reuse-authentication-state">Reuse authentication state<a aria-hidden="true" class="hash-link" href="#reuse-authentication-state" title="Direct link to heading">â€‹</a></h2><p>Web apps use cookie-based or token-based authentication, where authenticated state is stored as <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies" target="_blank" rel="noopener noreferrer">cookies</a>. Playwright provides <a href="/java/docs/next/api/class-apirequestcontext#api-request-context-storage-state">APIRequestContext.storageState([options])</a> method that can be used to retrieve storage state from an authenticated context and then create new contexts with that state.</p><p>Storage state is interchangeable between <a title="BrowserContext" href="/java/docs/next/api/class-browsercontext">BrowserContext</a> and <a title="APIRequestContext" href="/java/docs/next/api/class-apirequestcontext">APIRequestContext</a>. You can use it to log in via API calls and then create a new context with cookies already there. The following code snippet retrieves state from an authenticated <a title="APIRequestContext" href="/java/docs/next/api/class-apirequestcontext">APIRequestContext</a> and creates a new <a title="BrowserContext" href="/java/docs/next/api/class-browsercontext">BrowserContext</a> with that state.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">APIRequestContext requestContext = playwright.request().newContext(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  new APIRequest.NewContextOptions().setHttpCredentials(&quot;user&quot;, &quot;passwd&quot;));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">requestContext.get(&quot;https://api.example.com/login&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Save storage state into a variable.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String state = requestContext.storageState();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Create a new context with the saved storage state.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BrowserContext context = browser.newContext(new Browser.NewContextOptions().setStorageState(state));</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/java/docs/next/actionability"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Auto-waiting</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/java/docs/next/assertions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Assertions<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#writing-api-test" class="table-of-contents__link toc-highlight">Writing API Test</a><ul><li><a href="#configure" class="table-of-contents__link toc-highlight">Configure</a></li><li><a href="#write-tests" class="table-of-contents__link toc-highlight">Write tests</a></li><li><a href="#setup-and-teardown" class="table-of-contents__link toc-highlight">Setup and teardown</a></li><li><a href="#complete-test-example" class="table-of-contents__link toc-highlight">Complete test example</a></li></ul></li><li><a href="#prepare-server-state-via-api-calls" class="table-of-contents__link toc-highlight">Prepare server state via API calls</a></li><li><a href="#check-the-server-state-after-running-user-actions" class="table-of-contents__link toc-highlight">Check the server state after running user actions</a></li><li><a href="#reuse-authentication-state" class="table-of-contents__link toc-highlight">Reuse authentication state</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/java/docs/intro">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/java/docs/api/class-playwright">API reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/playwright" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://aka.ms/playwright-slack" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/playwrightweb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/microsoft/playwright-java" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC46Zj8pDH5tDosqm1gd7WTg" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/java/blog">Conference videos</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Microsoft</div></div></div></footer></div>
<script src="/java/assets/js/runtime~main.ce20a0bc.js"></script>
<script src="/java/assets/js/main.1b15c50b.js"></script>
</body>
</html>